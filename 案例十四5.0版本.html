<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€’ç‰©æµæ•°æ®åˆ†æä¸ä¼˜åŒ–</title>
    
    <!-- ä½¿ç”¨å¤šä¸ªCDNå¤‡é€‰æ–¹æ¡ˆ -->
    <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" onerror="this.onerror=null;this.href='https://unpkg.com/bootstrap@5.1.3/dist/css/bootstrap.min.css';">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .card {
            background-color: rgba(255, 255, 255, 0.98);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            border-radius: 15px;
            border: none;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .chart-container {
            height: 400px;
            margin: 20px 0;
            position: relative;
        }
        .analysis-step {
            padding: 20px;
            border-left: 4px solid #007bff;
            margin: 15px 0;
            background: #f8f9fa;
            border-radius: 0 10px 10px 0;
        }
        .data-source {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
        }
        .season-analysis {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        .highlight-text {
            color: #dc3545;
            font-weight: bold;
        }
        .solution-card {
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 15px 0;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
            border-radius: 10px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            color: #dc3545;
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid #f5c6cb;
        }
        .success-message {
            color: #155724;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid #c3e6cb;
        }
        .fallback-chart {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            flex-direction: column;
        }
        .title-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        .stat-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        .stat-card h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        .stat-card h2 {
            margin-bottom: 5px;
            font-size: 2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <div class="title-header">
                <h1>å¿«é€’ç‰©æµæ•°æ®åˆ†æä¸ä¼˜åŒ–æ–¹æ¡ˆ</h1>
                <p class="mb-0">åŸºäºæ¡ˆä¾‹æ•°æ®çš„ç»¼åˆåˆ†æä¸å»ºæ¨¡</p>
            </div>
            
            <!-- ä¸»è¦ç»Ÿè®¡æ•°æ® -->
            <div class="row">
                <div class="col-md-4">
                    <div class="stat-card">
                        <h3>å¹´è¥ä¸šé¢</h3>
                        <h2>çªç ´800äº¿å…ƒ</h2>
                        <p class="mb-0">æ•°æ®æ¥æºï¼šæ¡ˆä¾‹ææ–™</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card">
                        <h3>ç”µå•†ä¼ä¸šæ•°é‡</h3>
                        <h2>8000ä½™å®¶</h2>
                        <p class="mb-0">æ•°æ®æ¥æºï¼šæ¡ˆä¾‹ææ–™</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card">
                        <h3>å¹´è®¢å•é‡</h3>
                        <h2>çªç ´2.75äº¿å•</h2>
                        <p class="mb-0">æ•°æ®æ¥æºï¼šæ¡ˆä¾‹åˆ†æä¼°ç®—</p>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div id="systemStatus" class="card">
                <div class="card-body">
                    <h5 class="card-title">ç³»ç»ŸçŠ¶æ€</h5>
                    <div id="statusContent">
                        <div class="loading">ç³»ç»Ÿåˆå§‹åŒ–ä¸­...</div>
                    </div>
                </div>
            </div>

            <!-- åŒºåŸŸåˆ†å¸ƒåˆ†æ -->
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">åŒºåŸŸåˆ†å¸ƒåˆ†æ</h2>
                    <div id="regionChart" class="chart-container">
                        <div class="loading">å›¾è¡¨åŠ è½½ä¸­</div>
                    </div>
                    <div class="analysis-step">
                        <h4>åˆ†æè¿‡ç¨‹ï¼š</h4>
                        <ol>
                            <li>æ ¹æ®äº”ä¸ªä»·æ ¼åŒºåŸŸåˆ’åˆ†è¿›è¡Œæ•°æ®å»ºæ¨¡</li>
                            <li>è€ƒè™‘äººå£å¯†åº¦å’Œç»æµå‘å±•æ°´å¹³</li>
                            <li>è®¡ç®—å„åŒºåŸŸä¸šåŠ¡é‡å æ¯”</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- æˆæœ¬åˆ†ææ¨¡å‹ -->
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">å¿«é€’æˆæœ¬åˆ†ææ¨¡å‹</h2>
                    <div class="analysis-step">
                        <h4>æˆæœ¬è®¡ç®—å…¬å¼ï¼š</h4>
                        <div class="alert alert-info">
                            <strong>æ€»æˆæœ¬ = (å–ä»¶åŸºç¡€è´¹ç”¨ + å¿«é€’å‘˜ææˆ + è½¦è¾†æˆæœ¬ + è¿è¾“æŸè€—) Ã— å­£èŠ‚ç³»æ•° Ã— åŒºåŸŸç³»æ•°</strong>
                        </div>
                        <p>ä¸»è¦æ„æˆï¼š</p>
                        <ul>
                            <li>å–ä»¶åŸºç¡€è´¹ç”¨ï¼š2å…ƒ/å•</li>
                            <li>å¿«é€’å‘˜ææˆï¼šåŸºç¡€è´¹ç”¨çš„4%</li>
                            <li>è½¦è¾†æˆæœ¬ï¼š0.1å…ƒ/å•ï¼ˆè®¡ç®—åˆ°æœ€è¿‘é›†æ•£ç‚¹ï¼‰</li>
                            <li>è¿è¾“æŸè€—ï¼š0.05å…ƒ/å•ï¼ˆé¢„ä¼°å€¼ï¼‰</li>
                        </ul>
                        <p class="data-source">*æ•°æ®æ¥æºï¼šæ¡ˆä¾‹å®é™…è¿è¥æ•°æ®</p>
                    </div>
                    <div id="costChart" class="chart-container">
                        <div class="loading">å›¾è¡¨åŠ è½½ä¸­</div>
                    </div>
                </div>
            </div>

            <!-- äº¤äº’å¼æˆæœ¬è®¡ç®—å™¨ -->
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">å¿«é€’æˆæœ¬è®¡ç®—å™¨</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <form id="costCalculator" class="p-3">
                                <div class="mb-3">
                                    <label class="form-label">åŒ…è£¹é‡é‡(kg)</label>
                                    <input type="number" class="form-control" id="weight" step="0.1" min="0" value="1">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">è¿è¾“è·ç¦»(km)</label>
                                    <input type="number" class="form-control" id="distance" min="0" value="100">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">é…é€åŒºåŸŸ</label>
                                    <select class="form-select" id="region">
                                        <option value="1">æ±Ÿæµ™æ²ª</option>
                                        <option value="2">ååŒ—åœ°åŒº</option>
                                        <option value="3">åå—åœ°åŒº</option>
                                        <option value="4">è¥¿éƒ¨åœ°åŒº</option>
                                        <option value="5">å…¶ä»–åœ°åŒº</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">å­£èŠ‚</label>
                                    <select class="form-select" id="season">
                                        <option value="1">æ˜¥å­£(3-5æœˆ)</option>
                                        <option value="2">å¤å­£(6-8æœˆ)</option>
                                        <option value="3">ç§‹å­£(9-11æœˆ)</option>
                                        <option value="4">å†¬å­£(12-2æœˆ)</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">è®¡ç®—æˆæœ¬</button>
                            </form>
                        </div>
                        <div class="col-md-6">
                            <div id="costResult" class="p-3 border rounded">
                                <h5>æˆæœ¬è®¡ç®—ç»“æœ</h5>
                                <div id="costBreakdown">è¯·è¾“å…¥å‚æ•°å¹¶ç‚¹å‡»è®¡ç®—</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ•°æ®å»ºæ¨¡è¿‡ç¨‹ -->
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">æ•°æ®å»ºæ¨¡è¿‡ç¨‹</h2>
                    <div class="accordion" id="modelingAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#basicModel">
                                    1. åŸºç¡€æˆæœ¬æ¨¡å‹
                                </button>
                            </h2>
                            <div id="basicModel" class="accordion-collapse collapse show">
                                <div class="accordion-body">
                                    <p>å¿«é€’æˆæœ¬æ„æˆï¼š</p>
                                    <ul>
                                        <li>å–ä»¶åŸºç¡€è´¹ç”¨ï¼š2å…ƒ/å•</li>
                                        <li>å¿«é€’å‘˜ææˆï¼šå–ä»¶è´¹ç”¨çš„4%</li>
                                        <li>è½¦è¾†æˆæœ¬ï¼š0.1å…ƒ/å•(åˆ°æœ€è¿‘é›†æ•£ç‚¹)</li>
                                        <li>è¿è¾“æŸè€—ï¼š0.05å…ƒ/å•(é¢„ä¼°å€¼)</li>
                                    </ul>
                                    <p class="data-source">*åŸºäºæ¡ˆä¾‹å®é™…æ•°æ®</p>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#seasonalModel">
                                    2. å­£èŠ‚æ€§è°ƒæ•´ç³»æ•°
                                </button>
                            </h2>
                            <div id="seasonalModel" class="accordion-collapse collapse">
                                <div class="accordion-body">
                                    <p>åŸºäºä¸šåŠ¡é‡å’ŒäººåŠ›æˆæœ¬å˜åŒ–ï¼š</p>
                                    <ul>
                                        <li>æ˜¥å­£(3-5æœˆ)ï¼šÃ—1.0 (åŸºå‡†æœŸ)</li>
                                        <li>å¤å­£(6-8æœˆ)ï¼šÃ—1.1 (äººåŠ›æˆæœ¬ç•¥å¢)</li>
                                        <li>ç§‹å­£(9-11æœˆ)ï¼šÃ—1.3 (æ—ºå­£äººåŠ›æˆæœ¬å¢åŠ )</li>
                                        <li>å†¬å­£(12-2æœˆ)ï¼šÃ—1.2 (å¯’å†·å¤©æ°”å½±å“æ•ˆç‡)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#regionalModel">
                                    3. åŒºåŸŸè°ƒæ•´ç³»æ•°
                                </button>
                            </h2>
                            <div id="regionalModel" class="accordion-collapse collapse">
                                <div class="accordion-body">
                                    <p>æ ¹æ®é›†æ•£ä¸­å¿ƒåˆ†å¸ƒåŠè¿è¾“è·ç¦»ï¼š</p>
                                    <ul>
                                        <li>æ±Ÿæµ™æ²ªï¼šÃ—1.0 (åŸºå‡†åŒºåŸŸ)</li>
                                        <li>ååŒ—/åå—ï¼šÃ—1.2 (æ¬¡ä¸€çº§é›†æ•£ä¸­å¿ƒ)</li>
                                        <li>è¥¿éƒ¨åœ°åŒºï¼šÃ—1.4 (ç‰©æµç½‘ç»œç›¸å¯¹ç¨€ç–)</li>
                                        <li>å…¶ä»–åœ°åŒºï¼šÃ—1.5 (éœ€è¦å¤šæ¬¡è½¬è¿)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å­£èŠ‚æ€§åˆ†æ -->
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">å­£èŠ‚æ€§æˆæœ¬åˆ†æ</h2>
                    <div class="season-analysis">
                        <h4>å­£èŠ‚ç‰¹å¾ï¼š</h4>
                        <ul>
                            <li>ä¸ŠåŠå¹´ï¼ˆæ˜¥å¤è£…ï¼‰ï¼šåŒ…è£¹ä½“ç§¯å°ï¼Œé‡é‡è½»</li>
                            <li>ä¸‹åŠå¹´ï¼ˆç§‹å†¬è£…ï¼‰ï¼šåŒ…è£¹ä½“ç§¯å¤§ï¼Œé‡é‡é‡ï¼ˆç¾½ç»’æœã€æ£‰æœï¼‰</li>
                            <li class="highlight-text">æ—ºå­£ï¼ˆ10-1æœˆï¼‰ï¼šè®¢å•é‡å¤§å¹…å¢åŠ ï¼Œæˆæœ¬ä¸Šå‡</li>
                        </ul>
                        <p class="data-source">æ•°æ®æ¥æºï¼šç»‡é‡Œç«¥è£…è¡Œä¸šè¿è¥æ•°æ®åˆ†æ</p>
                    </div>
                </div>
            </div>

            <!-- è¿è¥ä¼˜åŒ–å»ºè®® -->
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">è¿è¥ä¼˜åŒ–å»ºè®®</h2>
                    <div class="solution-card">
                        <h4>é’ˆå¯¹æ€§è§£å†³æ–¹æ¡ˆï¼š</h4>
                        <div class="row">
                            <div class="col-md-4">
                                <h5>æ—ºå­£åº”å¯¹</h5>
                                <ul>
                                    <li>æå‰å‚¨å¤‡äººåŠ›èµ„æº</li>
                                    <li>å¢åŠ ä¸´æ—¶ä»“å‚¨ç©ºé—´</li>
                                    <li>ä¼˜åŒ–é…é€è·¯çº¿è§„åˆ’</li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <h5>æˆæœ¬æ§åˆ¶</h5>
                                <ul>
                                    <li>å»ºç«‹åŒºåŸŸé›†æ•£ä¸­å¿ƒ</li>
                                    <li>ä¼˜åŒ–è½¦è¾†è°ƒåº¦ç³»ç»Ÿ</li>
                                    <li>å®æ–½åˆ†æ—¶æ®µé…é€</li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <h5>æœåŠ¡æå‡</h5>
                                <ul>
                                    <li>æä¾›å¢å€¼æœåŠ¡é€‰é¡¹</li>
                                    <li>å»ºç«‹å¿«é€Ÿå“åº”æœºåˆ¶</li>
                                    <li>å®Œå–„å®¢æˆ·åé¦ˆç³»ç»Ÿ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è„šæœ¬åŠ è½½ -->
    <script>
        // å…¨å±€å˜é‡
        let systemReady = false;
        let chartsLoaded = false;
        
        // ç³»ç»ŸçŠ¶æ€æ›´æ–°
        function updateSystemStatus(message, type = 'info') {
            const statusContent = document.getElementById('statusContent');
            if (statusContent) {
                const className = type === 'error' ? 'error-message' : 
                                type === 'success' ? 'success-message' : 'loading';
                statusContent.innerHTML = `<div class="${className}">${message}</div>`;
            }
        }

        // åŸºç¡€åŠŸèƒ½æ£€æŸ¥
        function checkBasicFunctions() {
            updateSystemStatus('æ£€æŸ¥åŸºç¡€åŠŸèƒ½...');
            
            // æ£€æŸ¥åŸºæœ¬DOMæ“ä½œ
            try {
                const testElement = document.createElement('div');
                testElement.innerHTML = '<span>æµ‹è¯•</span>';
                if (testElement.children.length === 0) {
                    throw new Error('DOMæ“ä½œå¼‚å¸¸');
                }
                
                updateSystemStatus('åŸºç¡€åŠŸèƒ½æ£€æŸ¥é€šè¿‡', 'success');
                return true;
            } catch (error) {
                updateSystemStatus('åŸºç¡€åŠŸèƒ½æ£€æŸ¥å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        // åŠ è½½å¤–éƒ¨èµ„æº
        function loadExternalResources() {
            return new Promise((resolve, reject) => {
                updateSystemStatus('åŠ è½½å¤–éƒ¨èµ„æº...');
                
                // æ£€æŸ¥Bootstrap
                if (typeof bootstrap === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.bootcdn.net/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js';
                    script.onerror = () => {
                        script.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js';
                        script.onerror = () => {
                            updateSystemStatus('BootstrapåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸºç¡€åŠŸèƒ½', 'error');
                            resolve(false);
                        };
                        script.onload = () => {
                            updateSystemStatus('BootstrapåŠ è½½æˆåŠŸ', 'success');
                            resolve(true);
                        };
                    };
                    script.onload = () => {
                        updateSystemStatus('BootstrapåŠ è½½æˆåŠŸ', 'success');
                        resolve(true);
                    };
                    document.head.appendChild(script);
                } else {
                    updateSystemStatus('Bootstrapå·²åŠ è½½', 'success');
                    resolve(true);
                }
            });
        }

        // å°è¯•åŠ è½½ECharts
        function loadECharts() {
            return new Promise((resolve) => {
                if (typeof echarts !== 'undefined') {
                    chartsLoaded = true;
                    resolve(true);
                    return;
                }

                const script = document.createElement('script');
                script.src = 'https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js';
                script.onerror = () => {
                    script.src = 'https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js';
                    script.onerror = () => {
                        updateSystemStatus('å›¾è¡¨åº“åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ˜¾ç¤º', 'error');
                        showFallbackCharts();
                        resolve(false);
                    };
                    script.onload = () => {
                        chartsLoaded = true;
                        updateSystemStatus('å›¾è¡¨åº“åŠ è½½æˆåŠŸ', 'success');
                        initializeCharts();
                        resolve(true);
                    };
                };
                script.onload = () => {
                    chartsLoaded = true;
                    updateSystemStatus('å›¾è¡¨åº“åŠ è½½æˆåŠŸ', 'success');
                    initializeCharts();
                    resolve(true);
                };
                document.head.appendChild(script);
            });
        }

        // æ˜¾ç¤ºå¤‡ç”¨å›¾è¡¨
        function showFallbackCharts() {
            const chartContainers = document.querySelectorAll('.chart-container');
            chartContainers.forEach(container => {
                container.innerHTML = `
                    <div class="fallback-chart">
                        <h5>ğŸ“Š å›¾è¡¨æ•°æ®</h5>
                        <p>å›¾è¡¨åº“åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºç®€åŒ–ç‰ˆæœ¬</p>
                        <div class="text-start">
                            <p><strong>åŒºåŸŸåˆ†å¸ƒï¼š</strong></p>
                            <p>â€¢ æ±Ÿæµ™æ²ªï¼š35%</p>
                            <p>â€¢ ååŒ—åœ°åŒºï¼š25%</p>
                            <p>â€¢ åå—åœ°åŒºï¼š20%</p>
                            <p>â€¢ è¥¿éƒ¨åœ°åŒºï¼š15%</p>
                            <p>â€¢ å…¶ä»–åœ°åŒºï¼š5%</p>
                        </div>
                    </div>
                `;
            });
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initializeCharts() {
            if (!chartsLoaded) return;

            try {
                // åŒºåŸŸåˆ†å¸ƒå›¾è¡¨
                const regionChart = echarts.init(document.getElementById('regionChart'));
                if (regionChart) {
                    const regionOption = {
                        title: { text: 'å„åŒºåŸŸä¸šåŠ¡é‡åˆ†å¸ƒ' },
                        tooltip: { trigger: 'item', formatter: '{b}: {c}%' },
                        series: [{
                            type: 'pie',
                            radius: '70%',
                            data: [
                                {value: 35, name: 'æ±Ÿæµ™æ²ª'},
                                {value: 25, name: 'ååŒ—åœ°åŒº'},
                                {value: 20, name: 'åå—åœ°åŒº'},
                                {value: 15, name: 'è¥¿éƒ¨åœ°åŒº'},
                                {value: 5, name: 'å…¶ä»–åœ°åŒº'}
                            ]
                        }]
                    };
                    regionChart.setOption(regionOption);
                }

                // æˆæœ¬åˆ†æå›¾è¡¨
                const costChart = echarts.init(document.getElementById('costChart'));
                if (costChart) {
                    const costOption = {
                        title: { text: 'æˆæœ¬æ„æˆåˆ†æ' },
                        tooltip: { trigger: 'axis' },
                        legend: { data: ['è¿è¾“æˆæœ¬', 'äººå·¥æˆæœ¬', 'å…¶ä»–æˆæœ¬'] },
                        xAxis: { type: 'category', data: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'] },
                        yAxis: { type: 'value', name: 'æˆæœ¬ï¼ˆä¸‡å…ƒï¼‰' },
                        series: [
                            { name: 'è¿è¾“æˆæœ¬', type: 'line', data: [150, 160, 170, 185, 190, 200] },
                            { name: 'äººå·¥æˆæœ¬', type: 'line', data: [80, 85, 90, 95, 100, 110] },
                            { name: 'å…¶ä»–æˆæœ¬', type: 'line', data: [40, 45, 50, 55, 60, 65] }
                        ]
                    };
                    costChart.setOption(costOption);
                }

                // æ¸…é™¤åŠ è½½æç¤º
                document.querySelectorAll('.chart-container .loading').forEach(el => {
                    el.style.display = 'none';
                });

                updateSystemStatus('å›¾è¡¨åˆå§‹åŒ–å®Œæˆ', 'success');
            } catch (error) {
                updateSystemStatus('å›¾è¡¨åˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
                showFallbackCharts();
            }
        }

        // åˆå§‹åŒ–æˆæœ¬è®¡ç®—å™¨
        function initializeCostCalculator() {
            const form = document.getElementById('costCalculator');
            if (!form) return;

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                try {
                    const weight = parseFloat(document.getElementById('weight').value) || 0;
                    const distance = parseFloat(document.getElementById('distance').value) || 0;
                    const region = document.getElementById('region').value;
                    const season = document.getElementById('season').value;

                    // åŸºç¡€æˆæœ¬è®¡ç®—
                    const pickupFee = 2.0;
                    const courierCommission = pickupFee * 0.04;
                    const vehicleCost = 0.1;
                    const transportLoss = 0.05;

                    // ç³»æ•°
                    const seasonMultipliers = {'1': 1.0, '2': 1.1, '3': 1.3, '4': 1.2};
                    const regionMultipliers = {'1': 1.0, '2': 1.2, '3': 1.2, '4': 1.4, '5': 1.5};

                    const seasonMultiplier = seasonMultipliers[season] || 1.0;
                    const regionMultiplier = regionMultipliers[region] || 1.0;

                    const baseCost = pickupFee + courierCommission + vehicleCost + transportLoss;
                    const totalCost = baseCost * seasonMultiplier * regionMultiplier;

                    // æ˜¾ç¤ºç»“æœ
                    const resultDiv = document.getElementById('costBreakdown');
                    if (resultDiv) {
                        resultDiv.innerHTML = `
                            <div class="row mb-2">
                                <div class="col-6">åŸºç¡€è´¹ç”¨ï¼š</div>
                                <div class="col-6">${pickupFee.toFixed(2)}å…ƒ</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6">å¿«é€’å‘˜ææˆï¼š</div>
                                <div class="col-6">${courierCommission.toFixed(2)}å…ƒ</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6">è½¦è¾†æˆæœ¬ï¼š</div>
                                <div class="col-6">${vehicleCost.toFixed(2)}å…ƒ</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6">è¿è¾“æŸè€—ï¼š</div>
                                <div class="col-6">${transportLoss.toFixed(2)}å…ƒ</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6">å­£èŠ‚ç³»æ•°ï¼š</div>
                                <div class="col-6">Ã—${seasonMultiplier}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6">åŒºåŸŸç³»æ•°ï¼š</div>
                                <div class="col-6">Ã—${regionMultiplier}</div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-6"><strong>æ€»æˆæœ¬ï¼š</strong></div>
                                <div class="col-6"><strong>${totalCost.toFixed(2)}å…ƒ</strong></div>
                            </div>
                        `;
                    }
                } catch (error) {
                    const resultDiv = document.getElementById('costBreakdown');
                    if (resultDiv) {
                        resultDiv.innerHTML = `<div class="error-message">è®¡ç®—å¤±è´¥: ${error.message}</div>`;
                    }
                }
            });
        }

        // ç³»ç»Ÿåˆå§‹åŒ–
        function initializeSystem() {
            updateSystemStatus('ç³»ç»Ÿåˆå§‹åŒ–ä¸­...');
            
            // æ£€æŸ¥åŸºç¡€åŠŸèƒ½
            if (!checkBasicFunctions()) {
                return;
            }

            // åŠ è½½å¤–éƒ¨èµ„æº
            loadExternalResources().then(() => {
                // åŠ è½½å›¾è¡¨åº“
                loadECharts().then(() => {
                    // åˆå§‹åŒ–è®¡ç®—å™¨
                    initializeCostCalculator();
                    
                    // ç³»ç»Ÿå°±ç»ª
                    systemReady = true;
                    updateSystemStatus('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸', 'success');
                    
                    // éšè—çŠ¶æ€å¡ç‰‡
                    setTimeout(() => {
                        const statusCard = document.getElementById('systemStatus');
                        if (statusCard) {
                            statusCard.style.display = 'none';
                        }
                    }, 3000);
                });
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeSystem);
        } else {
            initializeSystem();
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´å›¾è¡¨
        window.addEventListener('resize', function() {
            if (chartsLoaded && typeof echarts !== 'undefined') {
                echarts.getInstanceByDom(document.getElementById('regionChart'))?.resize();
                echarts.getInstanceByDom(document.getElementById('costChart'))?.resize();
            }
        });
    </script>
</body>
</html>
